plan:
  - validate
  - integrate
  - deploy

hooks:
  pre_setup: bin/pre_setup

tool_config:
  git:
    version: 1.8.5.5

phantomjs:
  version: '1.9.7'

nodejs:
  version: '6.2.1'

java:
  java_version: java-8-openjdk
  maven_version: '3.3.9'

# This outputs the JUnit test results
report_files:
  - "target/surefire-reports/*.xml"

profiles:
  validate:
    tests:
      - python scripts/installRefApp.py -i ${PREDIX_PREFIX:-$USER} --only=validate

  integrate:
    hooks:
      pre_setup: |
        set -e
        bin/pre_setup
        cd rmd-ref-app-ui
        export PATH=$PATH:`pwd`/node_modules/.bin/
        npm install
        npm install bower
        npm install grunt-cli
        bower install
    tests:
      - type: junit
        command: cd dataingestion-service && mvn test
      - type: junit
        command: cd data-seed-service && mvn test
      - type: junit
        command: cd machinedata-simulator && mvn test
      - type: junit
        command: cd predix-websocket-server && mvn test
      - type: junit
        command: cd rmd-datasource && mvn test
      - cd rmd-ref-app-ui && npm test || exit 0

  deploy:
    hooks:
      pre_setup: |
        set -e
        export PATH=$PATH:`pwd`/node_modules/.bin/
        bin/pre_setup
        npm install bower
        npm install grunt-cli
    tests:
      - PATH=$PATH:`pwd`/node_modules/.bin/ python scripts/installRefApp.py -i ${PREDIX_PREFIX:-$USER}
